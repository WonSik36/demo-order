# 연관관계 매핑 기초
> 김영한 님의 _자바 ORM 표준 JPA 프로그래밍_ (에이콘출판주식회사, 2020) 을 읽고 정리하였습니다.

## 단방향 연관 관계
* `@JoinColumn`
  * 외래키를 매핑할때 사용

| 속성                                                                         | 기능                     | 기본값                          |
|----------------------------------------------------------------------------|------------------------|------------------------------|
| name                                                                       | 매핑할 외래 키 이름            | 필드명 + _ + 참조하는 테이블의 기본 키 컬럼명 |
| referencedColumnName                                                       | 외래 키가 참조하는 대상 테이블의 컬럼명 | 참조하는 테이블의 기본키 컬럼명            |
| foreignKey(DDL)                                                            | 외래 키 제약조건을 직접 지정할수 있음  |                              |
| unique<br>nullable<br>insertable<br>updatable<br>columnDefinition<br>table | @Column 속성과 같다         |                              |

* `@ManyToOne`
  * 다대일 관계에서 사용

| 속성           | 기능                                                          | 기본값                                                     |
|--------------|-------------------------------------------------------------|---------------------------------------------------------|
| optional     | false 인 경우, 연관된 엔티티가 항상 있어야함                                | true                                                    |
| fetch        | 글로벌 패치 전략 설정                                                | @ManyToOne=FetchType.EAGER<br>@OneToMany=FetchType.LAZY |
| cascade      | 영속성 전이 기능 설정                                                |                                                         |
| targetEntity | 연관된 엔티티의 타입 정보 설정. 컬렉션을 사용해도 제네릭으로 타입정보를 알수 있기에 거의 사용하지 않음  |                                                         |


## 양방향 연관관계
* 엔티티를 양방향 연관관계로 설정시, 객체의 참조는 둘인데, 외래 키는 하나인 차이 발생
* 두 객체 중 하나를 정해서 연관관계 주인 설정 필요
  * 주인이 외래키를 소유 (외래키가 있는 곳이 주인)
    * 연관 관계의 주인이 외래키 관리
  * 주인이 아니면 mappedBy 속성 사용
    * 주인이 다른 연관 관계를 참조할때 사용하는 필드명 (연관 관계의 주인)

* `@OneToMany`
  * 일대다 관계에서 사용

| 속성            | 기능                                                         | 기본값                                                     |
|---------------|------------------------------------------------------------|---------------------------------------------------------|
| mappedBy      | 연관 관계를 관리하는 필드명                                            |                                                         |
| fetch         | 글로벌 패치 전략 설정                                               | @ManyToOne=FetchType.EAGER<br>@OneToMany=FetchType.LAZY |
| cascade       | 영속성 전이 기능 설정                                               |                                                         |
| orphanRemoval | 연관 관계에서 제거된 경우 삭제 혹은 주인 객체 삭제시 전이 여부                       | false                                                   |
| targetEntity  | 연관된 엔티티의 타입 정보 설정. 컬렉션을 사용해도 제네릭으로 타입정보를 알수 있기에 거의 사용하지 않음 |                                                         |

